<!DOCTYPE html>
<html>

<head>
    <title>Appointment Booking</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/node_modules/flatpickr/dist/flatpickr.min.css">
</head>

<body>
    <form id="specialty-form">
        <label for="doctorSpecialty">Select a specialty:</label>
        <select id="doctorSpecialty" name="doctorSpecialty">
            <option value="">Select a specialty</option>
            <!-- Add options for specialties here -->
        </select>
        <button type="submit">Search Doctors</button>
    </form>

    <div id="doctors-list"></div>

    <div id="doctor-details"></div>

    <script>
        // Sample data for doctors
        const doctors = [
            {
                "doctorid": "d1",
                "name": "Dr. John Smith",
                "specialty": "Cardiologist",
                "experience": "15 years",
                "availableTimeSlots": [
                    "2023-11-15 09:00",
                    "2023-11-15 10:00",
                    "2023-11-16 11:00",
                ],
            },
            {
                "doctorid": "d2",
                "name": "Dr. Sarah Johnson",
                "specialty": "Pediatrician",
                "experience": "10 years",
                "availableTimeSlots": [
                    "2023-11-15 13:00",
                    "2023-11-16 14:00",
                ],
            },
            // Add more doctor data here
        ];

        document.addEventListener("DOMContentLoaded", function () {
            const specialtyForm = document.getElementById("specialty-form");
            const specialtySelect = document.getElementById("doctorSpecialty");
            const doctorsList = document.getElementById("doctors-list");
            const doctorDetails = document.getElementById("doctor-details");

            // Function to create doctor cards
            function createDoctorCard(doctor) {
                const card = document.createElement("div");
                card.innerHTML = `
                    <div>
                        <h3>${doctor.name}</h3>
                        <p>Specialty: ${doctor.specialty}</p>
                        <p>Experience: ${doctor.experience}</p>
                        <button class="view-timeslots" data-doctorid="${doctor.doctorid}">View Time Slots</button>
                    </div>
                `;
                return card;
            }

            // Function to display available time slots
            function showTimeSlots(doctorId) {
                doctorDetails.innerHTML = "";
                const doctor = doctors.find(d => d.doctorid === doctorId);

                if (doctor) {
                    const timeSlotSelect = document.createElement("select");
                    timeSlotSelect.id = "time-slot";
                    timeSlotSelect.name = "timeSlot";
                    timeSlotSelect.innerHTML = '<option value="">Select a time slot</option>';

                    doctor.availableTimeSlots.forEach(timeSlot => {
                        const option = document.createElement("option");
                        option.value = timeSlot;
                        option.textContent = new Date(timeSlot).toLocaleString();
                        timeSlotSelect.appendChild(option);
                    });

                    // Add an event listener to prevent selecting past dates
                    timeSlotSelect.addEventListener("change", function () {
                        const selectedTime = new Date(this.value);
                        const now = new Date();
                        if (selectedTime <= now) {
                            alert("Please select a future time slot.");
                            this.value = "";
                        }
                    });

                    const bookButton = document.createElement("button");
                    bookButton.textContent = "Book Appointment";

                    // Add an event listener for booking the appointment
                    bookButton.addEventListener("click", function () {
                        const selectedTimeSlot = timeSlotSelect.value;
                        if (selectedTimeSlot) {
                            alert("Appointment booked for " + new Date(selectedTimeSlot).toLocaleString());
                        } else {
                            alert("Please select a time slot.");
                        }
                    });

                    doctorDetails.appendChild(timeSlotSelect);
                    doctorDetails.appendChild(bookButton);
                }
            }

            // Add specialties to the dropdown
            const specialties = [...new Set(doctors.map(doctor => doctor.specialty))];
            specialties.forEach(specialty => {
                const option = document.createElement("option");
                option.value = specialty;
                option.textContent = specialty;
                specialtySelect.appendChild(option);
            });

            // Add an event listener for the form submission
            specialtyForm.addEventListener("submit", function (e) {
                e.preventDefault();
                const selectedSpecialty = specialtySelect.value;
                doctorsList.innerHTML = "";

                if (selectedSpecialty) {
                    const matchingDoctors = doctors.filter(doctor => doctor.specialty === selectedSpecialty);

                    if (matchingDoctors.length > 0) {
                        matchingDoctors.forEach(doctor => {
                            const card = createDoctorCard(doctor);
                            doctorsList.appendChild(card);

                            const viewTimeSlotsButton = card.querySelector(".view-timeslots");
                            viewTimeSlotsButton.addEventListener("click", function () {
                                const doctorId = this.getAttribute("data-doctorid");
                                showTimeSlots(doctorId);
                            });
                        });
                    } else {
                        doctorsList.innerHTML = "<p>No doctors found for this specialty.</p>";
                    }
                } else {
                    doctorsList.innerHTML = "<p>Please select a specialty.</p>";
                }
            });
        });
    </script>
</body>

</html>
